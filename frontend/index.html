<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Acme Product Importer - Demo</title>
  <style>
    body { 
      font-family: system-ui, Arial; 
      max-width: 900px; 
      margin: 40px auto; 
      padding: 20px;
    }
    .progress { 
      width: 100%; 
      height: 30px;
      margin-top: 10px;
    }
    .card { 
      padding: 20px; 
      border: 1px solid #eee; 
      border-radius: 8px; 
      margin-bottom: 12px; 
      background: #f9f9f9;
    }
    .danger { color: #b00; }
    .success { color: #0a0; }
    #messages {
      margin-top: 15px;
      padding: 15px;
      border-radius: 5px;
      background: white;
      border: 1px solid #ddd;
      min-height: 50px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-left: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    input[type="file"] {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>üöÄ Acme Product Importer ‚Äî Demo UI</h1>
  
  <div class="card">
    <h3>üì§ Upload CSV File</h3>
    <input id="file" type="file" accept=".csv" />
    <button id="uploadBtn">Upload & Process</button>
    
    <div id="messages">Select a CSV file and click Upload...</div>
    <progress id="progress" class="progress" value="0" max="100" style="display:none;"></progress>
  </div>

  <script>
const API_URL = "http://localhost:8000";

const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('file');
const messages = document.getElementById('messages');
const progress = document.getElementById('progress');

uploadBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if (!file) {
    messages.innerHTML = '<span class="danger">‚ö†Ô∏è Please select a CSV file</span>';
    return;
  }

  if (!file.name.endsWith('.csv')) {
    messages.innerHTML = '<span class="danger">‚ö†Ô∏è Only CSV files are allowed</span>';
    return;
  }

  // Disable button during upload
  uploadBtn.disabled = true;
  messages.innerHTML = '‚è≥ Uploading file...';
  progress.style.display = 'block';
  progress.value = 50;

  try {
    const form = new FormData();
    form.append('file', file);

    const resp = await fetch(`${API_URL}/upload`, {
      method: 'POST',
      body: form
    });

    if (!resp.ok) {
      const error = await resp.json();
      throw new Error(error.detail || 'Upload failed');
    }

    const data = await resp.json();
    const jobId = data.job_id || data.task_id;

    progress.value = 100;
    
    messages.innerHTML = `
<span class="success">‚úÖ Upload successful!</span>

<strong>Job ID:</strong> ${jobId}
<strong>Filename:</strong> ${data.filename}
<strong>Status:</strong> ${data.status}

The file is being processed in the background.
Check Docker logs to see progress:
  docker-compose logs -f worker
    `;

    // Reset after 3 seconds
    setTimeout(() => {
      fileInput.value = '';
      uploadBtn.disabled = false;
      progress.style.display = 'none';
      progress.value = 0;
    }, 3000);

  } catch (error) {
    progress.style.display = 'none';
    messages.innerHTML = `<span class="danger">‚ùå Error: ${error.message}</span>`;
    uploadBtn.disabled = false;
  }
});

// Show file name when selected
fileInput.addEventListener('change', (e) => {
  if (e.target.files[0]) {
    messages.innerHTML = `üìÑ Selected: <strong>${e.target.files[0].name}</strong>`;
  }
});
</script>

</body>
</html>