<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Acme Product Importer - Demo</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 900px; margin: 40px auto; }
    .progress { width: 100%; }
    .card { padding: 12px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 12px; }
    .danger { color: #b00; }
  </style>
</head>
<body>
  <h1>Acme Product Importer â€” Demo UI</h1>
  <div class="card">
    <h3>Upload CSV</h3>
    <input id="file" type="file" accept=".csv" />
    <button id="uploadBtn">Upload</button>
    <div id="messages"></div>
    <progress id="progress" class="progress" value="0" max="100"></progress>
  </div>
  <script>
const API_URL = "http://localhost:8000";

const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('file');
const messages = document.getElementById('messages');
const progress = document.getElementById('progress');

uploadBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if (!file) return alert('Select a CSV file');

  const form = new FormData();
  form.append('file', file);

  const resp = await fetch(`${API_URL}/upload`, {
    method: 'POST',
    body: form
  });

  const data = await resp.json();
  const jobId = data.job_id;

  messages.innerText = 'Job queued: ' + jobId;

  const ws = new WebSocket(`ws://localhost:8000/ws/jobs/${jobId}`);

  ws.onmessage = (ev) => {
    const payload = JSON.parse(ev.data);
    messages.innerText = JSON.stringify(payload);
    if (payload.percent) progress.value = payload.percent;
  };
});
</script>

</body>
</html>
